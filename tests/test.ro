[my_calc]

- test_count int

// asserts bool
# AssertB(expected bool, actual bool, $caller_line)
  test_count++

  if expected != actual
    print("error:", nil, $caller_line, nil, ": expected:", expected, "actual:", actual)
    exit(1)

// asserts int
# AssertI(expected int, actual int, $caller_line)
  test_count++

  if expected != actual
    print("error:", nil, $caller_line, nil, ": expected:", expected, "actual:", actual)
    exit(1)

// asserts float
# AssertF(expected float, actual float, $caller_line)
  test_count++

  if expected != actual
    print("error:", nil, $caller_line, nil, ": expected:", expected, "actual:", actual)
    exit(1)

//-----------------------------------------------------------------------------
# seven() int
  return 7

# add(x int, y int) int
  return x + y

# twice(n *int)
  *n = *n * 2

- g_array [4]int

:: Color
  | R // 0
  | G // 1
  | B // 2

# main() int

  ---
    - id int
    id = 114
    AssertI(125, id + 11)

  ---
    - i int = 19
    AssertI(19, i)

  ---
    AssertI(42, 39 + 3)

  ---
    - id int
    id = 0
    AssertI(114, id + 114)

  ---
    AssertI(4422, 3129 + 1293)

  ---
    AssertI(5533, 3129 + 1293+1111)

  ---
    AssertI(42, 20+22)

  ---
    - a int
    a = 12
    AssertI(12, a)

  ---
    - a int
    a = 11
    AssertI(11, a)

  ---
    AssertB(false, 12 == 11)

  ---
    AssertB(true, 42 == 42)

  ---
    - a int
    a = 39
    AssertB(true, a == 39)

  ---
    - a int
    a = 39
    AssertB(true, a == 39)

  ---
    AssertI(7, seven())

  ---
    AssertI(42, seven() + 35)

  ---
    AssertI(42, seven() + add(30, 5))

  ---
    - a int
    - b int
    a = 42
    if a == 12
      b = 11
    or
      b = 22
    AssertI(22, b)

  ---
    - a int
    - b int
    a = 42
    if a == 42
      b = 11
    or
      b = 22
    AssertI(11, b)

  // C++ test
  // ==========================================================================

  // switch with multi case values
  ---
    - n = 6
    - x = 0

    switch n
    case 1
      x = 11
    case 2, 3, 4
      x = 22
    case 13, 55, 6
      x = 99
    default
      x = 255
    AssertI(99, x)

  // switch with multi case values
  ---
    - n = 3
    - x = 0

    switch n
    case 1
      x = 11
    case 2, 3, 4
      x = 22
    case 13, 55, 6
      x = 99
    default
      x = 255
    AssertI(22, x)

  // bool default
  ---
    - b bool
    - c = true
    AssertB(true, b == false)
    AssertB(true, c != false)

  // pointer variable
  ---
    - i int = 42
    - p *int
    p = &i
    AssertI(42, *p)

  // pointer argument
  ---
    - i int = 13
    twice(&i)
    AssertI(26, i)

  // array variable
  ---
    - a [8]int
    - i = 9
    a[2] = 87
    AssertI(87, a[2])
    a[5] = 92
    AssertI(92, a[5])
    i = a[2] + a[5]
    AssertI(179, i)

  // array variable with const expression
  ---
    - a [2 + 8]int
    - i = 7
    a[2] = 8
    AssertI(8, a[2])
    a[5] = 2
    AssertI(2, a[5])
    i = a[2] + a[5]
    AssertI(10, i)

  // global array variable
  ---
    g_array[3] = 99
    AssertI(99, g_array[3])

  // table
  ---
    - a = Color.R
    AssertI(0, a)
    AssertI(1, Color.G)
    AssertI(3, a + Color.G + Color.B)

  // module import
  ---
    AssertF(3.1415, my_calc.PI)
    my_calc.PI = 1.23
    AssertF(1.23, my_calc.PI)
    AssertI(42, my_calc.add(31, 11))

  //------------------------------
  print(test_count, "tests done.")

  return 0
